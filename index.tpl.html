<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Website Navigator</title>
        <script src="https://kit.fontawesome.com/433c98b60c.js" crossorigin="anonymous" data-auto-replace-svg="nest"></script>
        <style>
            body {
                font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
                -webkit-user-select: none;
                user-select: none;
                font-size: calc(1.5rem - 0.35vw);
                height: 100vh;
                width: 100vw;
                overflow: hidden;
                margin: 0;
                display: flex;
                justify-content: center;
                align-items: center;
                
            }
            a {
                color: rgb(0, 94, 172);
                text-underline-offset: .15em;
                transition: color 0.25s ease-in-out;
            }
            a:hover {
                color: rgb(0, 57, 104);
            }
            small {
                a {
                    color: rgb(91, 181, 255);
                    text-underline-offset: .15em;
                    transition: color 0.25s ease-in-out;
                }
                a:hover {
                    color: rgb(27, 152, 255);
                }
            }
            .no-dot {
                list-style-type: none;
            }
            .hide {
                display: none;
            }
            .click {
                cursor: pointer;
            }
            main {
                margin: 6rem;
                border-radius: 0.5rem;
                background-color: rgba(255, 255, 255, 0.45);
                backdrop-filter: blur(5rem);
                padding: 1rem;
                padding-left: 2rem;
                padding-right: 2rem;
                box-shadow: 0 0 1rem rgba(0, 0, 0, 0.5);
                height: 50vh;
                width: 40vw;
                overflow: auto;
            }
            .bg {
                filter: sepia(0.45) hue-rotate(10deg);
                background-image: url('cool-bg.jpg');
                background-position: center;
                background-size: cover;
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
            }
            small {
                position: absolute;
                bottom: 10px;
                left: 20px;
                font-size: 1rem;
                color: white;
            }
        </style>
    </head>
    <body>
        % import os, os.path, time
        
        <% 
        from pint import UnitRegistry
        ureg = UnitRegistry()
        Q_ = ureg.Quantity
def make(dir='./'):
    dir = os.path.abspath(dir)
    x = "<ul class=\"fa-ul no-dot\" style='--fa-li-margin: 2em; margin-bottom: 0.25rem;'>"
    y = 0
    for entry in os.scandir(dir):
        y+=1
        if entry.is_file() and not entry.name.startswith("index.tpl") and not entry.name.startswith("."):
            size = Q_(entry.stat().st_size, 'byte').to_compact()
            x += f"<li><span class=\"fa-li\"><i class=\"fa-regular fa-fw fa-file\"></i></span><a href=\"/{os.path.relpath(entry.path)[0:]}\">{entry.name} | {round(size.magnitude, 1)} {size.units}(s)</a></li>"
        elif entry.is_dir() and not entry.name.startswith("."):
            x += f"<li><span class=\"click\"><span class=\"fa-li\"><i class=\"fa-solid fa-fw fa-folder-open\"></i></span>{entry.name}</span><br>"
            x += make(entry.path)
            x += "</li>"
        end
    end
    if y == 0:
        x += "<li style=\"margin-left: -1.5em;\"><i>(empty)</i></li>"
    end
    x += "</ul>"
    return x
end
            %>
            <div class="bg"></div>
            <main>
                <h1>Website Navigator</h1>
                <p>Click on the folder icons to expand or collapse the directory tree.
                    Click on the files to open them.</p>
                {{!make()}}
            </main>
            <small>Image from <a href="https://unsplash.com/photos/birds-eye-view-of-mountains-eluzJSfkNCk" rel="noopener">Unsplash</a></small>
            <script>
                window.onload = () => {
                    document.querySelectorAll(".fa-ul li:has(.fa-ul) .click").forEach(x => {
                        x.addEventListener("click", e => {
                            let y = x.querySelector("& i").children[0];
                            if (y.classList.values().toArray().includes('fa-folder')) {
                                y.classList.add("fa-solid", "fa-folder-open");
                            } else {
                                y.classList.add("fa-solid", "fa-folder");
                            }
                            x.closest("li").querySelector("ul").classList.toggle("hide");
                        });
                    });
                };
            </script>
    </body>
</html>